<div class="registration-container">
  <div class="registration-content">
    <!-- Left Section - Welcome -->
    <div class="welcome-section">
      <div class="welcome-content">
        <h1 class="brand-title text-gradient">Join Us Today</h1>
        <p class="brand-subtitle">Start planning amazing events</p>
        <div class="feature-list">
          <div class="feature-item">
            <i class="bi bi-calendar-check"></i>
            <span>Manage Events Effortlessly</span>
          </div>
          <div class="feature-item">
            <i class="bi bi-people"></i>
            <span>Collaborate with Teams</span>
          </div>
          <div class="feature-item">
            <i class="bi bi-graph-up"></i>
            <span>Track Progress in Real-time</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Section - Registration Form -->
    <div class="form-section">
      <div class="form-card">
        <div class="form-header">
          <h2>Create Account</h2>
          <p>Fill in your details to get started</p>
        </div>

        <!-- Alert Messages -->
        <div *ngIf="showMessage" class="alert alert-success fade-in">
          {{responseMessage}}
        </div>
        <div *ngIf="showError" class="alert alert-danger fade-in">
          {{errorMessage}}
        </div>

        <!-- Registration Form -->
        <form [formGroup]="itemForm" (ngSubmit)="onRegister()" class="registration-form">
          <div class="form-group">
            <label class="form-label">Username <span class="required-asterisk">*</span></label>
            <input 
              type="text" 
              id="username" 
              formControlName="username"
              class="form-control" 
              placeholder="Choose a username"
              [ngClass]="{
                'is-invalid': itemForm.get('username')?.invalid && itemForm.get('username')?.touched,
                'is-valid': itemForm.get('username')?.valid && itemForm.get('username')?.touched
              }">
              <div class="password-requirements" *ngIf="showUsernameRequirements && itemForm.get('username')?.dirty">
                <ul>
                  <li *ngFor="let rule of usernameRules" [class.satisfied]="rule.satisfied" [hidden]="rule.satisfied">
                    <small>{{ rule.label }}</small>
                  </li>
                </ul>
              </div>
          </div>

          <div class="form-group">
            <label class="form-label">Email<span class="required-asterisk">*</span></label>
            <input 
              type="email" 
              id="email" 
              formControlName="email"
              class="form-control" 
              placeholder="Enter your email"
              [ngClass]="{
                'is-invalid': itemForm.get('email')?.invalid && itemForm.get('email')?.touched,
                'is-valid': itemForm.get('email')?.valid && itemForm.get('email')?.touched
              }">
            <small *ngIf="itemForm.get('email')?.hasError('required') && (itemForm.get('email')?.touched || itemForm.get('email')?.dirty)"
              class="error-text">
              <i class="bi bi-exclamation-circle"></i> Email is required
            </small>
            <small *ngIf="itemForm.get('email')?.hasError('pattern') && (itemForm.get('email')?.touched || itemForm.get('email')?.dirty)"
              class="error-text">
              <i class="bi bi-exclamation-circle"></i> Email is invalid
            </small>
          </div>

          <div class="form-group">
            <label class="form-label">Name<span class="required-asterisk">*</span></label>
            <input 
              type="text" 
              id="name" 
              formControlName="name"
              class="form-control" 
              placeholder="Enter your name"
              [ngClass]="{
                'is-invalid': itemForm.get('name')?.invalid && itemForm.get('name')?.touched,
                'is-valid': itemForm.get('name')?.valid && itemForm.get('name')?.touched
              }">
            <small *ngIf="itemForm.get('name')?.hasError('required') && itemForm.get('name')?.touched"
              class="error-text">
              <i class="bi bi-exclamation-circle"></i> Name is required
            </small>
            <small *ngIf="itemForm.get('name')?.hasError('pattern') && itemForm.get('name')?.touched"
                     class="error-text">
                <i class="bi bi-exclamation-circle"></i> Name should contain only letters and spaces 
              </small>
              <!-- ok -->
          </div>

          <div class="form-group">
            <label class="form-label">Password<span class="required-asterisk">*</span></label>
            <div class="password-input-wrapper">
              <input 
                [type]="showPassword ? 'text' : 'password'" 
                id="password" 
                formControlName="password"
                class="form-control" 
                placeholder="Create a strong password"
                [ngClass]="{
                  'is-invalid': itemForm.get('password')?.invalid && itemForm.get('password')?.touched,
                  'is-valid': itemForm.get('password')?.valid && itemForm.get('password')?.touched
                }">
              <button type="button" class="password-toggle-btn" (click)="togglePasswordVisibility()">
                üëÅÔ∏è‚Äçüó®Ô∏è
              </button>
            </div>
            <div class="password-requirements" *ngIf="showPasswordRequirements && itemForm.get('password')?.dirty">
              <ul>
                <li *ngFor="let rule of passwordRules" [class.satisfied]="rule.satisfied" [hidden]="rule.satisfied">
                  <small>{{ rule.label }}</small>
                </li>
              </ul>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Role <span class="required-asterisk">*</span></label>
            <select 
              id="role" 
              formControlName="role" 
              class="form-control"
              [ngClass]="{
                'is-invalid': itemForm.get('role')?.invalid && itemForm.get('role')?.touched,
                'is-valid': itemForm.get('role')?.valid && itemForm.get('role')?.touched
              }">
              <option value="">Select Your Role</option>
              <option value="STAFF">Staff Member</option>
              <option value="PLANNER">Event Planner</option>
              <option value="CLIENT">Client</option>
            </select>
            <small *ngIf="itemForm.get('role')?.hasError('required') && itemForm.get('role')?.touched"
              class="error-text">
              <i class="bi bi-exclamation-circle"></i> Please select a role
            </small>
          </div>

          <!-- Access Key Field (Only for PLANNER) -->
          <div class="form-group" *ngIf="itemForm.get('role')?.value === 'PLANNER'">
            <label class="form-label">Access Key<span class="required-asterisk">*</span></label>
            <div class="password-input-wrapper">
              <input 
                [type]="showAccessKey ? 'text' : 'password'" 
                id="accessKey" 
                formControlName="accessKey"
                class="form-control" 
                placeholder="Enter planner access key"
                [ngClass]="{
                  'is-invalid': itemForm.get('accessKey')?.invalid && itemForm.get('accessKey')?.touched,
                  'is-valid': itemForm.get('accessKey')?.valid && itemForm.get('accessKey')?.touched
                }">
              <button type="button" class="password-toggle-btn" (click)="toggleAccessKeyVisibility()">
                <i class="bi" [ngClass]="showAccessKey ? 'bi-eye-slash' : 'bi-eye'"></i>
              </button>
            </div>
            <small class="form-text text-muted">
              <i class="bi bi-info-circle"></i> Contact administrator for access key
            </small>
            <small *ngIf="itemForm.get('accessKey')?.hasError('required') && itemForm.get('accessKey')?.touched"
              class="error-text">
              <i class="bi bi-exclamation-circle"></i> Access key is required for PLANNER role
            </small>
          </div>

          <!-- CAPTCHA Field -->
          <div class="form-group captcha-container">
            <label class="form-label">Security Check<span class="required-asterisk">*</span></label>
            <div class="captcha-box">
              <div class="captcha-question">
                <span class="captcha-num">{{ captchaNum1 }}</span>
                <span class="captcha-operator">+</span>
                <span class="captcha-num">{{ captchaNum2 }}</span>
                <span class="captcha-equals">=</span>
                <span class="captcha-question-mark">?</span>
              </div>
              <button type="button" class="btn btn-sm btn-outline-secondary refresh-btn" (click)="refreshCaptcha()">
                üîÑÔ∏è
              </button>
            </div>
            <input 
              type="number" 
              id="captchaAnswer" 
              formControlName="captchaAnswer"
              class="form-control mt-2" 
              placeholder="Enter the answer"
              [ngClass]="{
                'is-invalid': itemForm.get('captchaAnswer')?.invalid && itemForm.get('captchaAnswer')?.touched,
                'is-valid': itemForm.get('captchaAnswer')?.valid && itemForm.get('captchaAnswer')?.touched
              }">
            <small *ngIf="itemForm.get('captchaAnswer')?.hasError('required') && itemForm.get('captchaAnswer')?.touched"
              class="error-text">
              ‚ùó Please solve the math problem
            </small>
          </div>

          <button 
            type="submit" 
            class="btn btn-primary btn-register" 
            [disabled]="itemForm.invalid">
            <span *ngIf="!itemForm.pending">Create Account</span>
            <span *ngIf="itemForm.pending" class="spinner-border spinner-border-sm"></span>
          </button>
        </form>

        <!-- Footer -->
        <div class="form-footer">
          <p>Already have an account? <a [routerLink]="['/login']" class="link-primary">Sign In</a></p>
        </div>
      </div>
    </div>
  </div>
</div>
